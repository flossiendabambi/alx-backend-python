#!/bin/bash

set -e

echo "ğŸš€ Applying blue deployment update (image v2.0)..."
kubectl apply -f blue_deployment.yaml

echo "ğŸ”„ Monitoring rolling update..."
kubectl rollout status deployment/django-blue

echo "ğŸ§ª Testing for downtime..."
SERVICE_IP=$(minikube service django-service --url)

for i in {1..10}; do
  curl --max-time 2 $SERVICE_IP || echo "âŒ Request failed"
  sleep 1
done

echo "âœ… Current pods after update:"
kubectl get pods -l app=django,version=blue
